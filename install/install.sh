#!/bin/bash
# for unix systems
# 1: chmod +x install.sh
# 2: sudo ./install.sh

install_dependencies() {
    sudo apt-get update
    sudo apt-get install python3 python3-pip python3-dev libpcap-dev -y

    sudo pip3 install -r requirements.txt
    echo "Dependencies installed successfully!"
}

create_service() {
    python_path=$(which python3)
    needed_dir=$(dirname "$(pwd)")
    echo "[Unit]
    Description=pocket-pentester
    After=multi-user.target

    [Service]
    User=root
    Group=root
    Type=simple
    Restart=always
    ExecStart=$python_path $needed_dir

    [Install]
    WantedBy=multi-user.target" > /etc/systemd/system/pocketPentester.service
}

reload_daemon() {
    sudo systemctl daemon-reload
}

start_service() {
    sudo systemctl start pocketPentester.service
}

install_dependencies
create_service
reload_daemon

read -p "Do you want to start service with bot? (y/n): " choice
if [ "$choice" == "y" ]; then
    start_service
fi